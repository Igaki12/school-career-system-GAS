## GASコードの設定とトリガー設定手順（経験者向け）

1.  **準備:**
    *   Google スプレッドシートに「フォームの回答」シート、「支払い確認」シート、「設定」シートを用意します。
    *   「設定」シートに、コード内で指定された役割（A組担任, B組担任..., 進路部, 事務室, 管理者）と対応するメールアドレスを入力します。

2.  **スクリプトの設置:**
    *   **どちらか一方の**スプレッドシート（例: 調査書作成願のスプレッドシート）を開きます。
    *   メニューバーから「拡張機能」>「Apps Script」を選択し、エディタを開きます。
    *   エディタのファイル一覧（左側）で「＋」アイコン > 「スクリプト」をクリックし、新しいスクリプトファイルを作成します。
    *   1つ目のファイル名を `TranscriptRequest` などに変更し、調査書作成願用のコード全体を貼り付けます。
    *   同様にもう一つスクリプトファイルを作成し、ファイル名を `PaymentProcessing` などに変更し、支払い確認用のコード全体を貼り付けます。
    *   **忘れずにプロジェクト全体を保存します**（フロッピーディスクアイコン）。

3.  **トリガーの手動設定:**
    *   Apps Script エディタの左メニューから「トリガー」（時計アイコン）をクリックします。
    *   右下の「＋ トリガーを追加」ボタンをクリックして、以下の3つのトリガーを**それぞれ**設定します。

    *   **トリガー1： 調査書作成願 - 新規フォーム送信時**
        *   実行する関数を選択: `processNewSubmission`
        *   実行するデプロイを選択: `Head`
        *   イベントのソースを選択: `スプレッドシートから`
        *   イベントの種類を選択: `フォーム送信時`
        *   エラー通知設定: `今すぐ通知を受け取る` （推奨）
        *   「保存」をクリックします。

    *   **トリガー2： 調査書作成願 - シート編集時**
        *   （再度「＋ トリガーを追加」をクリック）
        *   実行する関数を選択: `onSheetEdit`
        *   実行するデプロイを選択: `Head`
        *   イベントのソースを選択: `スプレッドシートから`
        *   イベントの種類を選択: `編集時`
        *   エラー通知設定: `今すぐ通知を受け取る` （推奨）
        *   「保存」をクリックします。

    *   **トリガー3： 支払い確認 - 新規フォーム送信時**
        *   （再度「＋ トリガーを追加」をクリック）
        *   実行する関数を選択: `processPaymentSubmission`
        *   実行するデプロイを選択: `Head`
        *   イベントのソースを選択: `スプレッドシートから`
        *   イベントの種類を選択: `フォーム送信時`
        *   **【重要】** このトリガーは**支払い確認フォームが紐づくスプレッドシート**のイベントを検知する必要があります。もしスクリプトを設置したスプレッドシートと支払い確認フォームのスプレッドシートが**異なる**場合は、このトリガー設定が正しく機能しない可能性があります。その場合は、支払い確認フォームのスプレッドシート側にもスクリプト（PaymentProcessing）を設置するか、コード内で `SpreadsheetApp.openById()` を使う等の対応が必要です。ここでは**スクリプトを設置したスプレッドシートで両方のイベント（調査書作成願と支払い確認）を処理できる**前提で説明しています。
        *   エラー通知設定: `今すぐ通知を受け取る` （推奨）
        *   「保存」をクリックします。

4.  **承認:**
    *   各トリガーを初めて保存する際に、Googleアカウントによる**承認**が求められます。
    *   スクリプトがスプレッドシートの読み書きやGmail送信を行うための許可です。内容を確認し、「許可」をクリックしてください。（複数回求められる場合があります）

5.  **最終確認:**
    *   実際にフォームを送信したり、「フォームの回答」シートの担当者確認欄を編集したりして、意図した通りにメール送信やシート更新が行われるかテストしてください。
    *   Apps Script エディタの「実行数」メニューで、エラーが発生していないかログを確認してください。

これで設定は完了です。